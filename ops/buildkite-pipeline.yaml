steps:
  - label: "Build, Lint, and Audit"
    key: build
    if: build.branch != "main"
    command: "nix develop --command just lint"
    agents:
      nix: true
      production: false
  - label: "Test"
    key: test
    if: build.branch == "main"
    agents:
      xwindows: true
      nix: true
      production: false
    env:
      CYPRESS_tags: "@CI"
      BERKELEY_FEATURES_ENABLED: true
    command: "nix develop --command just test"
  - label: "Deploy to Production"
    key: deploy
    if: build.branch == "main"
    depends_on: test
    agents:
      nix: true
      production: true
    command: "nix develop --command just publish"
